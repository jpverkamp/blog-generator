/** 
 * @projectDescription JsFlickrGallery - Simple JavaScript Flickr gallery, 
 * http://petejank.github.io/js-flickr-gallery/
 * 
 * @version 1.22
 * @author   Peter Jankowski http://likeadev.com
 * @license  MIT license.
 */ 
;!function(a,b,c){"use strict";function x(b,d){this.element=b,this.$element=a(b),this.options=a.extend(!0,{},w,d),this.paginationContext=this.options.pagination&&this.options.pagination.generate?this.element:c,this.options.thumbnailSize||this.options.imageSize||this.options.setDefaultSize(),this.galleryId=this.element.id||Math.random().toString(36),this.page=1,this.init()}var e="json",f="flickr.photos.search",g="flickr.photosets.getPhotos",h="62525ee8c8d131d708d33d61f29434b6",i="data-tags",j="data-user-id",k="data-set-id",l="data-per-page",m="data-gallery-id",n="jsfg",o=767,p=1e4,q="modal-header",r="h3",s="modal-body",t="modal-image",u="modal-footer",v="jsFlickrGallery",w={fetchImages:!0,animation:"fade",animationSpeed:250,preload:{range:2},structure:{ulClass:".thumbnails",liClass:".span1",aClass:".thumbnail"},modal:{generate:!0,id:"jsfg-modal",title:"."+q+" "+r,imageContainerClass:"."+t,onContainerNext:!0,imageFadeTime:250,prevClass:".btn.modal-prev",nextClass:".btn.modal-next",prevText:"Previous image",nextText:"Next image",offsetWidth:100,offsetHeight:200},pagination:{generate:!0,containerClass:".pagination",prevClass:".btn.pagination-prev",nextClass:".btn.pagination-next",prevText:"Previous page",nextText:"Next page"},loader:{animation:!0,loaderClass:".jsfg-loader",text:"Loading",interval:200,mark:".",markClass:".animation-marks",maxMarks:3},url:{per_page:30,tag_mode:"all"},error:{text:"No photos found",tagClass:"error"},imageSizes:{small:"s",medium_100:"t",medium:"q",medium_640:"z",large:"b",original:"o"},apiUrl:"http://api.flickr.com/services/rest/?jsoncallback=?",setDefaultSize:function(){this.thumbnailSize=this.imageSizes.medium,this.imageSize=this.imageSizes.large}};x.prototype={init:function(){this.options.fetchImages?(this.options.loader&&(this.loaderInterval=this._createLoader(this.element)),this.createGallery()):this.anchors=this._getAnchors(),this.options.pagination&&this.options.fetchImages&&(this.options.pagination.generate&&this._createPagination(),this._bindPaginationEvents()),this.options.modal&&(this.options.modal.generate&&this._createModal(),this._bindModalEvents())},createGallery:function(a){return this.options.url.format=e,this.options.url.api_key=h,this.options.url.photoset_id=this.$element.attr(k)||this.options.url.photoset_id,this.options.url.photoset_id?(this.options.url.method=g,delete this.options.url.tag_mode):(this.options.url.method=f,delete this.options.url.photoset_id,this.options.url.tags=this.$element.attr(i)||this.options.url.tags,this.options.url.user_id=this.$element.attr(j)||this.options.url.user_id,this.options.url.user_id||delete this.options.url.user_id),this.options.url.page=this.page=a||this.page,this.options.url.per_page=this.$element.attr(l)||this.options.url.per_page,this._getPhotos(),this},clearGallery:function(b){function e(){d.options.loader&&(d.loaderInterval=d._createLoader(d.element)),b&&d.createGallery(b),c.remove()}var c=a(this.options.structure.ulClass,this.element),d=this;switch(this.options.animation){case"fade":c.fadeOut(this.options.animationSpeed,e);break;case"show":c.hide(this.options.animationSpeed,e);break;case!1:c.hide(0,e)}return this},isLastPage:function(){return!this.anchors||this.anchors.length<this.options.url.per_page?!0:!1},nextPage:function(){return this.isLastPage()?!1:this.clearGallery(this.page+1)},prevPage:function(){return this.page>1?this.clearGallery(this.page-1):!1},prevImage:function(){return this.index-=1,this.index<0&&(this.index=this.anchors.length-1),this._loadImage(!1)},nextImage:function(){return this.index+=1,this.index>this.anchors.length-1&&(this.index=0),this._loadImage(!1)},_getPhotos:function(){var b=this;a.ajax({type:"GET",url:b.options.apiUrl,data:b.options.url,dataType:"jsonp",timeout:p}).done(function(a){b._renderGalleryContent(a.photos||a.photoset)}).always(function(a,c){"timeout"===c&&b._getPhotos()})},_renderGalleryContent:function(b){var e,f,i,j,k,d=this,g="",h=0,l=this._replaceDots(d.options.structure.liClass),m=this._replaceDots(d.options.structure.aClass);if(b.photo.length>0){f=a('<ul class="'+this._replaceDots(d.options.structure.ulClass)+'" style="display: none">');for(var n=0;n<b.photo.length;n++)i="http://farm"+b.photo[n].farm+".static.flickr.com/"+b.photo[n].server+"/"+b.photo[n].id+"_"+b.photo[n].secret+"_",j=this._htmlEscape(b.photo[n].title),g+='<li class="'+l+'">'+'<a href="'+i+d.options.imageSize+'.jpg" title="'+j+'" class="'+m+'" target="_blank">'+'<img alt="'+j+'" src="'+i+d.options.thumbnailSize+'.jpg"/>'+"</a>"+"</li>";d.element.insertBefore(f.append(g)[0],d.element.firstChild),e=f.find("img"),e.on("error",function(){var b=a(this),c=b.attr("src");b.attr("src",null).attr("src",c)}),e.on("load",function(){if(h++,h===b.photo.length){switch(d._removeLoader(d.element),d.options.animation){case"fade":f.fadeIn(d.options.animationSpeed);break;case"show":f.show(d.options.animationSpeed);break;case!1:f.show()}e.off("load").off("error"),d.anchors=d._getAnchors(),d._togglePagination()}})}else k=c.createElement("span"),k.className=d.options.error.tagClass,k.innerHTML=d.options.error.text,d.element.insertBefore(k,d.element.firstChild),d._removeLoader(d.element)._togglePagination();return d},_createPagination:function(){var b="",c=a(this.options.pagination.prevClass,this.paginationContext)[0],d=a(this.options.pagination.nextClass,this.paginationContext)[0];return c||d||!this.options.pagination.generate||(b+='<div class="'+this._replaceDots(this.options.pagination.containerClass)+'">'+"<button "+'class="'+this._replaceDots(this.options.pagination.prevClass)+'" '+'title="'+this.options.pagination.prevText+'" '+'disabled="disabled">&laquo;</button>'+"<button "+'class="'+this._replaceDots(this.options.pagination.nextClass)+'" '+'title="'+this.options.pagination.nextText+'" '+'disabled="disabled">&raquo;</button>'+"</div>",this.element.appendChild(a(b)[0])),this},_bindPaginationEvents:function(){var b=this,c=a(this.options.pagination.prevClass,this.paginationContext),d=a(this.options.pagination.nextClass,this.paginationContext);c.click(function(){c.is(":disabled")||(d.attr("disabled","disabled"),c.attr("disabled","disabled"),b.prevPage())}),d.click(function(){d.is(":disabled")||(c.attr("disabled","disabled"),d.attr("disabled","disabled"),b.nextPage())})},_togglePagination:function(){var b=a(this.options.pagination.prevClass,this.paginationContext),c=a(this.options.pagination.nextClass,this.paginationContext);return 1!==this.page?b.removeAttr("disabled"):b.attr("disabled","disabled"),this.isLastPage()?c.attr("disabled","disabled"):c.removeAttr("disabled"),this},_createModal:function(){var a,b,d,e;return c.getElementById(this.options.modal.id)||(a='<div class="'+q+'">'+'<button type="button" class="close" data-dismiss="modal" aria-hidden="true">'+"&times;</button>"+"<"+r+"></"+r+">"+"</div>",b='<div class="'+s+'">'+'<div class="'+t+'"></div>'+"</div>",d='<div class="'+u+'">'+'<button title="'+this.options.modal.prevText+'" class="'+this._replaceDots(this.options.modal.prevClass)+'">&laquo;</button>'+'<button title="'+this.options.modal.nextText+'" class="'+this._replaceDots(this.options.modal.nextClass)+'">&raquo;</button>'+"</div>",e=c.createElement("div"),e.id=this.options.modal.id,e.className="modal jsfg-modal hide fade",e.innerHTML=a+b+d,c.body.appendChild(e)),this},_bindModalEvents:function(){var b=this,c=this.options.modal.onContainerNext?this.options.modal.nextClass+", "+this.options.modal.imageContainerClass:this.options.modal.nextClass,d=a("#"+b.options.modal.id),e="#"+this.options.modal.id;return this.$element.on("click",this.options.structure.aClass,function(a){var c;for(a.preventDefault(),d.attr(m,b.galleryId),c=0;c<b.anchors.length;c++)b.anchors[c]===this&&(b.index=c);b._loadImage(!0)}),a(c,e).click(function(a){a.preventDefault(),d.attr(m)===b.galleryId&&b.nextImage()}),a(this.options.modal.prevClass,e).click(function(a){a.preventDefault(),d.attr(m)===b.galleryId&&b.prevImage()}),this},_loadImage:function(c){var d=this,e=a("#"+this.options.modal.id),f=a(this.options.modal.title,e),g=d.index,h=a(this.anchors[this.index]),i=a("<img/>"),j=a(this.options.modal.imageContainerClass,e),k=a(b);return j.children().hide(),f.text(h.attr("title")),c&&e.modal("show"),i.on("error",function(){i.prop("src",null).prop("src",h.attr("href"))}),i.on("load",function(){d.index===g&&(j.children().remove(),d._removeLoader(j[0]),i=d._resizeToFit(i,k),f.width(i.prop("width")),j.height(i.prop("height")).width(i.prop("width")),i.appendTo(j),k.width()>o?(e.css("top",""),(a.support.transition?e.animate:e.css).call(e.stop(),{"margin-left":-e.outerWidth()/2,"margin-top":-e.outerHeight()/2})):e.css({top:(k.height()-e.outerHeight())/2,"margin-left":"","margin-top":""}),i.fadeIn(d.options.modal.imageFadeTime),d.options.preload&&d._preloadImages()),i.off("load").off("error")}),i.prop("src",h.attr("href")).attr("alt",h.attr("title")),i[0].complete||(this.loaderInterval=this._createLoader(j[0])),this},_preloadImages:function(){var e,f,g,b=this.index+this.options.preload.range+1,d=this.index-this.options.preload.range;for(b=b>this.anchors.length?b-this.anchors.length:b,d=d>b?d-this.anchors.length:d,f=d;b>f;f++)g=0>f?this.anchors.length+f:f,e=this.anchors[g],e&&g!==this.index&&a(c.createElement("img")).attr("src",e.href||a(e).attr("href"));return this},_resizeToFit:function(a,b){var d,e,c=1,f=a.prop("width"),g=a.prop("height");return d=b.width()-this.options.modal.offsetWidth,e=b.height()-this.options.modal.offsetHeight,(f>d||g>e)&&(c=Math.min(d/f,e/g)),a.prop("width",f*c).prop("height",g*c),a},_createLoader:function(a){var b=c.createElement("span"),d=c.createElement("p"),e=this.options;return d.appendChild(c.createTextNode(e.loader.text)),d.className=this._replaceDots(e.loader.loaderClass),b.className=this._replaceDots(e.loader.markClass),a.insertBefore(d.appendChild(b).parentNode,a.firstChild),e.loader.animation?setInterval(function(){b.innerHTML.length<=e.loader.maxMarks?b.innerHTML+=e.loader.mark:b.innerHTML=""},e.loader.interval):!0},_getAnchors:function(){return a(this.options.structure.aClass,this.element).get()},_removeLoader:function(b){var c=a(this.options.loader.loaderClass,b)[0];return this.loaderInterval&&c&&(b.removeChild(c),clearInterval(this.loaderInterval)),this},_htmlEscape:function(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},_replaceDots:function(a){return a.replace(/\./g," ")}},a.fn[v]=function(b){return this.each(function(){a.data(this,"plugin_"+v)||a.data(this,"plugin_"+v,new x(this,b))})},a(function(){a('[data-toggle="'+n+'"]').jsFlickrGallery()})}(jQuery,window,document);